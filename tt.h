/*-------------------------------------------------------------------------------
 * tt.h
 * Tiny Tones Encoder and Decoder for Codec2 1600/3200 Voice Frames
 *
 * LWVMOBILE
 * 2026-01 Tiny Tones
 *-----------------------------------------------------------------------------*/

#ifndef TT_H
#define TT_H

#include <string.h>
#include <stdint.h>
#include <stdio.h>
#include <math.h>

#define TT_VER "0.1.3"

#define SILENCE_3200 0x010009439CE42108
#define SILENCE_1600 0x010004002575DDF2
#define LEN_3200 160
#define LEN_1600 320
#define FTOSGAIN 35
#define MAX_TT_FRAMES 0x49

typedef struct
{
  int tone_pitch;
  int tone_phase;
  int tone_frames_to_send;
  uint8_t tone_idx;
  uint8_t tone_gain;
} TINY_TONES;

#ifdef __cplusplus
extern "C" {
#endif

//function prototypes
void init_tt_struct(TINY_TONES * tt);
int tiny_tone_decoder (uint64_t silence_frame, uint8_t * input, int tone_phase, int len, short * audio);
int tiny_tone_encoder(uint64_t silence_frame, uint8_t idx, uint8_t gain_step, uint8_t * output);

#ifdef __cplusplus
}
#endif

static const uint32_t tt_frequencies[256][2] = {
    // Standard DTMF (16 entries)
    //0x00 - 0x0F
    { 941, 1336 },   // 0
    { 697, 1209 },   // 1
    { 697, 1336 },   // 2
    { 697, 1477 },   // 3
    { 770, 1209 },   // 4
    { 770, 1336 },   // 5
    { 770, 1477 },   // 6
    { 852, 1209 },   // 7
    { 852, 1336 },   // 8
    { 852, 1477 },   // 9
    { 697, 1633 },   // A
    { 770, 1633 },   // B
    { 852, 1633 },   // C
    { 941, 1633 },   // D
    { 941, 1209 },   // *
    { 941, 1477 },   // #

    // Knox tones (16 entries)
    //0x10 - 0x1F
    { 820, 1162 },   // 0
    { 606, 1052 },   // 1
    { 606, 1162 },   // 2
    { 606, 1279 },   // 3
    { 672, 1052 },   // 4
    { 672, 1162 },   // 5
    { 672, 1279 },   // 6
    { 743, 1052 },   // 7
    { 743, 1162 },   // 8
    { 743, 1279 },   // 9
    { 606, 1430 },   // A
    { 672, 1430 },   // B
    { 743, 1430 },   // C
    { 820, 1430 },   // D
    { 820, 1052 },   // *
    { 820, 1279 },   // #

    // Musical notes (divide by 100 for actual value)
    //0x20 - 0x2F
    {19600, 19600},   // G3
    {20765, 20765},   // G#3 / Ab3
    {22000, 22000},   // A3
    {23308, 23308},   // A#3 / Bb3
    {24694, 24694},   // B3
    {26163, 26163},   // C4   middle C
    {27718, 27718},   // C#4 / Db4
    {29366, 29366},   // D4
    {31113, 31113},   // D#4 / Eb4
    {32963, 32963},   // E4
    {34923, 34923},   // F4
    {36999, 36999},   // F#4 / Gb4
    {39200, 39200},   // G4
    {41530, 41530},   // G#4 / Ab4
    {44000, 44000},   // A4   concert pitch
    {46616, 46616},   // A#4 / Bb4
    //0x30 - 0x3F
    {49388, 49388},   // B4
    {52325, 52325},   // C5
    {55437, 55437},   // C#5 / Db5
    {58733, 58733},   // D5
    {62225, 62225},   // D#5 / Eb5
    {65925, 65925},   // E5
    {69846, 69846},   // F5
    {73999, 73999},   // F#5 / Gb5
    {78399, 78399},   // G5
    {83061, 83061},   // G#5 / Ab5
    {88000, 88000},   // A5
    {93233, 93233},   // A#5 / Bb5
    {98777, 98777},   // B5
    {104650, 104650}, // C6
    {110873, 110873}, // C#6 / Db6
    {117466, 117466}, // D6
    //0x40 - 0x49
    {124451, 124451}, // D#6 / Eb6
    {131851, 131851}, // E6
    {139691, 139691}, // F6
    {147998, 147998}, // F#6 / Gb6
    {156798, 156798}, // G6
    {166122, 166122}, // G#6 / Ab6
    {176000, 176000}, // A6
    {186466, 186466}, // A#6 / Bb6
    {197553, 197553}, // B6
    {209500, 209500}, // C7

    //reserved for future expansion
    //0x4A - 0x4F
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0x50 - 0x5F
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0x60 - 0x6F
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0x70 - 0x7F
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0x80 - 0x8F
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0x90 - 0x9F
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0xA0 - 0xAF
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0xB0 - 0xBF
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0xC0 - 0xCF
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0xD0 - 0xDF
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0xE0 - 0xEF
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},

    //0xF0 - 0xFF
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}
};

#endif //TT_H
